function getEnigmaVersion(){var e,t,r,i,n,E,o,d=PE.nLastSection,P=PE.section[d].FileOffset,$=PE.section[d].FileSize,d=(0==$&&(P=PE.section[d-1].FileOffset,$=PE.section[d-1].FileSize),PE.findSignature(P,$,"000000'ENIGMA'"))
return-1!=d?(e=PE.readByte(d+9),t=PE.readByte(d+10),r=PE.readWord(d+11),i=PE.readWord(d+13),n=PE.readWord(d+15),E=PE.readWord(d+17),o=PE.readWord(d+19),d=PE.readWord(d+21),sVersion=e+"."+t+" build "+r+"."+i+"."+n+" "+E+":"+o+":"+d,!0):-1!=PE.findSignature(P,$,"'Enigma Protector'")&&(sVersion="5.X",!0)}function getEnigmaVersion4x(){var e,t,r,i,n,E,o=PE.nLastSection,d=PE.section[o-1].FileOffset,o=PE.section[o-1].FileSize,d=PE.findSignature(d,o,"000000'ENIGMA'")
return-1!=d&&(o=PE.readByte(d+9),e=PE.readByte(d+10),t=PE.readWord(d+11),r=PE.readWord(d+13),i=PE.readWord(d+15),n=PE.readWord(d+17),E=PE.readWord(d+19),d=PE.readWord(d+21),sVersion=o+"."+e+" build "+t+"."+r+"."+i+" "+n+":"+E+":"+d,!0)}function getEnigmaVersion_old1x(){var e=PE.nLastSection
return-1!=PE.findSignature(PE.section[e].FileOffset,PE.section[e].FileSize,"'ENIGMA'07' PROT'")&&(sVersion="v1.14",!0)}function getEnigmaVersion_old(){var e=PE.section[".data"]
if(e){var t=e.FileOffset
if(-1!=(t=PE.findString(t,e.FileSize,"Enigma protector v")))return sVersion=PE.getString(t+18,4),!0}return!1}function detect(){return PE.isNet()?PE.isSignatureInSectionPresent(0,"000000'ENIGMA'")&&(bDetected=!0):(PE.is64()?(PE.compareEP("5051525355565741504151415241534154415541564157489C4881EC080000000FAE1C24E8000000005D")||PE.compareEP("eb$$60e8000000005d81ed........81ed........e9"))&&(getEnigmaVersion(),bDetected=!0):PE.compareEP("558bec83c4..b8........e8........9a............e9$$$$$$$$60e8000000005d..ed")||PE.compareEP("60e8000000005d81ed........81ed........e9")||PE.compareEP("68........e8$$$$$$$$eb$$83c4..e9$$$$$$$$60e8000000005d81ed")||PE.compareEP("eb$$e9$$$$$$$$60e8000000005d81ed........81ed........e9")||PE.compareEP("e8$$$$$$$$83c4..e9$$$$$$$$60e8000000005d81ed........81ed........e9")?(getEnigmaVersion(),bDetected=!0):PE.compareEP("60e8000000005d83....81ed")?(getEnigmaVersion_old(),bDetected=!0):PE.compareEP("eb$$e9$$$$$$$$60e8000000005d83....81ed")&&(getEnigmaVersion_old1x(),getEnigmaVersion_old(),bDetected=!0),bDetected||(1<PE.getNumberOfImports()&&1==PE.getNumberOfImportThunks(1)&&"MessageBoxA"==PE.getImportFunctionName(1,0)&&3758096448==PE.getSectionCharacteristics(0)&&getEnigmaVersion()||"enigma"==PE.getSectionNameCollision("1","2"))&&(bDetected=!0),PE.compareEP("60648b2d........3e8b6d..3e8b6d..e8........bb........c3")&&(getEnigmaVersion4x(),bDetected=!0)),result()}meta("protector","Enigma")
